<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat Emulator</title>
    <link rel="icon" href="data:," />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <main class="app-shell">
      <header class="hero card">
        <div>
          <h1>Chat Emulator</h1>
          <p>
            Загрузите экспорт диалога (JSON или папку с HTML‑историей) и откройте
            переписку с поиском по сообщениям.
          </p>
        </div>
      </header>

      <section class="controls card">
        <div class="upload-row">
          <label class="file-button" for="fileInput">
            Выбрать JSON
            <input
              id="fileInput"
              type="file"
              accept=".json,.js,application/json,text/javascript"
            />
          </label>

          <label class="file-button file-button-secondary" for="folderInput">
            Выбрать папку (HTML)
            <input
              id="folderInput"
              type="file"
              webkitdirectory
              directory
              multiple
            />
          </label>
        </div>

        <div class="status-row">
          <div class="progress-track" aria-hidden="true">
            <div id="progressBar" class="progress-bar"></div>
          </div>
          <div id="loadStatus" class="load-status">Источник не загружен</div>
        </div>

        <div id="chatMeta" class="chat-meta">Нет активного диалога</div>
      </section>

      <section class="search card">
        <label class="search-label" for="searchInput">Поиск по сообщениям</label>
        <div class="search-row">
          <input
            id="searchInput"
            type="search"
            placeholder="Введите текст"
            autocomplete="off"
            aria-controls="searchSuggestions"
            aria-expanded="false"
            aria-haspopup="listbox"
            aria-autocomplete="list"
            disabled
          />
          <button id="prevMatchBtn" type="button" disabled>Prev</button>
          <button id="nextMatchBtn" type="button" disabled>Next</button>
        </div>
        <div
          id="searchSuggestions"
          class="search-suggestions"
          role="listbox"
          hidden
        >
          <div id="searchSuggestionsCanvas" class="search-suggestions-canvas"></div>
        </div>
        <div id="searchStatus" class="search-status">Поиск недоступен</div>
      </section>

      <section class="chat card">
        <div class="chat-toolbar" aria-label="Навигация по переписке">
          <button id="openAttachmentsBtn" type="button" disabled>Вложения</button>
          <button id="scrollToTopBtn" type="button" disabled>В начало</button>
          <button id="scrollToBottomBtn" type="button" disabled>В конец</button>
        </div>
        <div id="chatViewport" class="chat-viewport">
          <div id="chatCanvas" class="chat-canvas"></div>
          <div id="emptyState" class="empty-state">
            Загрузите JSON или папку с HTML, чтобы увидеть переписку.
          </div>
        </div>
      </section>
    </main>

    <section
      id="attachmentsPanel"
      class="attachments-panel"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
      aria-labelledby="attachmentsTitle"
      hidden
    >
      <div class="attachments-dialog card">
        <header class="attachments-header">
          <div>
            <h2 id="attachmentsTitle">Вложения</h2>
            <p id="attachmentsCount" class="attachments-count">0 вложений</p>
          </div>
          <div class="attachments-header-actions">
            <label class="attachments-filter-toggle" for="attachmentsMediaOnlyToggle">
              <input id="attachmentsMediaOnlyToggle" type="checkbox" checked />
              <span>Исключить лишнее</span>
            </label>
            <button id="closeAttachmentsBtn" type="button">Закрыть</button>
          </div>
        </header>

        <div class="attachments-content">
          <div id="attachmentsList" class="attachments-list"></div>
        </div>
      </div>
    </section>

    <section
      id="mediaViewer"
      class="media-viewer"
      role="dialog"
      aria-modal="true"
      aria-hidden="true"
      aria-labelledby="mediaViewerLabel"
      hidden
    >
      <div class="media-viewer-dialog card">
        <header class="media-viewer-header">
          <p id="mediaViewerLabel" class="media-viewer-label">Просмотр вложения</p>
          <div class="media-viewer-actions">
            <button id="mediaViewerPrevBtn" type="button" aria-label="Предыдущее вложение">
              Назад
            </button>
            <button id="mediaViewerNextBtn" type="button" aria-label="Следующее вложение">
              Вперёд
            </button>
            <button id="mediaViewerJumpBtn" type="button">К сообщению</button>
            <a
              id="mediaViewerOpenOriginal"
              class="media-viewer-open-original"
              href="#"
              target="_blank"
              rel="noopener noreferrer"
            >
              Открыть оригинал
            </a>
            <button id="closeMediaViewerBtn" type="button">Закрыть</button>
          </div>
        </header>
        <div id="mediaViewerStage" class="media-viewer-stage"></div>
      </div>
    </section>

    <script type="module" src="./app.js"></script>
  </body>
</html>
